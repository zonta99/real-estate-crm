###############################################################################
# Real Estate CRM - API Testing Suite
#
# This file contains HTTP requests to test all API endpoints with mock data.
#
# Setup:
#   1. Start the application: ./mvnw spring-boot:run
#   2. Install VS Code "REST Client" extension OR use IntelliJ IDEA HTTP Client
#   3. Update the @baseUrl if your server runs on a different port
#   4. Login first to get tokens, then run other requests
#
# Usage:
#   - Click "Send Request" above any request (VS Code)
#   - Click the green arrow beside each request (IntelliJ)
#   - Use variables like {{token}} that auto-populate from responses
###############################################################################

@baseUrl = http://localhost:8080
@contentType = application/json

###############################################################################
# AUTHENTICATION ENDPOINTS
###############################################################################

### Login as Admin
# @name adminLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "admin",
  "password": "{{$dotenv ADMIN_PASSWORD}}"
}

### Login as Agent (Alice)
# @name agentLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "alice",
  "password": "password"
}

### Login as Broker (Bob)
# @name brokerLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "bob",
  "password": "password"
}

### Login as Agent (Carol)
# @name carolLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "carol",
  "password": "password"
}

### Login as Agent (David)
# @name davidLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "david",
  "password": "password"
}

### Login as Assistant (Emma)
# @name assistantLogin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "emma",
  "password": "password"
}

### Get Current User Info (requires authentication)
GET {{baseUrl}}/api/auth/user
Authorization: Bearer {{agentLogin.response.body.token}}

### Get User Permissions
GET {{baseUrl}}/api/auth/permissions
Authorization: Bearer {{agentLogin.response.body.token}}

### Refresh Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{agentLogin.response.body.refreshToken}}"
}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{agentLogin.response.body.token}}

###############################################################################
# PROPERTY ENDPOINTS
###############################################################################

### Get All Properties (Agent)
GET {{baseUrl}}/api/properties
Authorization: Bearer {{agentLogin.response.body.token}}

### Get All Properties with Pagination
GET {{baseUrl}}/api/properties?page=0&size=5&sort=price,desc
Authorization: Bearer {{agentLogin.response.body.token}}

### Get Property by ID (with attributes)
GET {{baseUrl}}/api/properties/1
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Properties by Price Range
GET {{baseUrl}}/api/properties/search?minPrice=300000&maxPrice=500000
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Properties by Status
GET {{baseUrl}}/api/properties/search?status=ACTIVE
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Properties with All Filters
GET {{baseUrl}}/api/properties/search?minPrice=200000&maxPrice=1000000&status=ACTIVE&page=0&size=10
Authorization: Bearer {{agentLogin.response.body.token}}

### Create New Property (Agent)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "title": "Beautiful Garden Home",
  "description": "Stunning 3-bedroom home with expansive garden and modern finishes. Perfect for nature lovers!",
  "price": 425000,
  "status": "ACTIVE"
}

### Update Property
PUT {{baseUrl}}/api/properties/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "title": "Cozy Family Home - Updated!",
  "description": "3-bed, 2-bath cozy home near parks and schools. Recently updated kitchen!",
  "price": 365000,
  "status": "ACTIVE"
}

### Update Property Status
PATCH {{baseUrl}}/api/properties/1/status?status=SOLD
Authorization: Bearer {{agentLogin.response.body.token}}

### Set Property Attribute Values
POST {{baseUrl}}/api/properties/1/attribute-values
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "attributeId": 1,
  "value": "123 Main Street, Springfield, IL"
}

### Get Property Attribute Values
GET {{baseUrl}}/api/properties/1/attribute-values
Authorization: Bearer {{agentLogin.response.body.token}}

### Share Property with Another User
POST {{baseUrl}}/api/properties/1/share
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "sharedWithUserId": 3
}

### Get Property Shares
GET {{baseUrl}}/api/properties/1/shares
Authorization: Bearer {{agentLogin.response.body.token}}

### Unshare Property
DELETE {{baseUrl}}/api/properties/1/share/3
Authorization: Bearer {{agentLogin.response.body.token}}

### Delete Property (requires owner or admin)
DELETE {{baseUrl}}/api/properties/1
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Properties by Saved Search Criteria
POST {{baseUrl}}/api/properties/search/by-criteria
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "minPrice": 300000,
  "maxPrice": 600000,
  "filters": [
    {
      "attributeId": 8,
      "dataType": "NUMBER",
      "minValue": 3,
      "maxValue": 5
    },
    {
      "attributeId": 9,
      "dataType": "NUMBER",
      "minValue": 2
    },
    {
      "attributeId": 2,
      "dataType": "SINGLE_SELECT",
      "selectedValues": ["Single Family Home", "Townhouse"]
    }
  ]
}

###############################################################################
# CUSTOMER ENDPOINTS
###############################################################################

### Get All Customers
GET {{baseUrl}}/api/customers
Authorization: Bearer {{agentLogin.response.body.token}}

### Get All Customers with Pagination
GET {{baseUrl}}/api/customers?page=0&size=5
Authorization: Bearer {{agentLogin.response.body.token}}

### Get Customer by ID
GET {{baseUrl}}/api/customers/1
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Customers by Name
GET {{baseUrl}}/api/customers/search?name=John
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Customers by Email
GET {{baseUrl}}/api/customers/search?email=john.smith@example.com
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Customers by Status
GET {{baseUrl}}/api/customers/search?status=LEAD
Authorization: Bearer {{agentLogin.response.body.token}}

### Search Customers by Budget Range
GET {{baseUrl}}/api/customers/search?minBudget=200000&maxBudget=500000
Authorization: Bearer {{agentLogin.response.body.token}}

### Create New Customer
POST {{baseUrl}}/api/customers
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "firstName": "Jessica",
  "lastName": "Brown",
  "email": "jessica.brown@example.com",
  "phone": "555-0199",
  "budgetMin": 400000,
  "budgetMax": 650000,
  "notes": "Looking for modern home with home office. Works remotely.",
  "leadSource": "Website Inquiry",
  "status": "LEAD"
}

### Update Customer
PUT {{baseUrl}}/api/customers/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "firstName": "John",
  "lastName": "Smith",
  "email": "john.smith@example.com",
  "phone": "555-0101",
  "budgetMin": 320000,
  "budgetMax": 480000,
  "notes": "Looking for family home with 3+ bedrooms. Needs good school district. Pre-approved for mortgage.",
  "leadSource": "Website Inquiry",
  "status": "QUALIFIED"
}

### Update Customer Status
PATCH {{baseUrl}}/api/customers/1/status?status=NEGOTIATING
Authorization: Bearer {{agentLogin.response.body.token}}

### Delete Customer
DELETE {{baseUrl}}/api/customers/1
Authorization: Bearer {{agentLogin.response.body.token}}

###############################################################################
# CUSTOMER INTERACTIONS ENDPOINTS
###############################################################################

### Get Customer Interactions
GET {{baseUrl}}/api/customers/1/interactions
Authorization: Bearer {{agentLogin.response.body.token}}

### Add Customer Interaction
POST {{baseUrl}}/api/customers/1/interactions
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "interactionType": "CALL",
  "notes": "Discussed budget and preferences. Customer interested in homes with pools.",
  "interactionDate": "2025-11-19T10:30:00"
}

### Update Customer Interaction
PUT {{baseUrl}}/api/customers/1/interactions/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "interactionType": "MEETING",
  "notes": "Met at office. Discussed budget, preferences, and financing options. Very motivated buyer.",
  "interactionDate": "2025-11-19T14:00:00"
}

### Delete Customer Interaction
DELETE {{baseUrl}}/api/customers/1/interactions/1
Authorization: Bearer {{agentLogin.response.body.token}}

###############################################################################
# CUSTOMER NOTES ENDPOINTS
###############################################################################

### Get Customer Notes
GET {{baseUrl}}/api/customers/1/notes
Authorization: Bearer {{agentLogin.response.body.token}}

### Add Customer Note
POST {{baseUrl}}/api/customers/1/notes
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "content": "Customer mentioned they need to move by end of Q1 2026 due to job relocation."
}

### Update Customer Note
PUT {{baseUrl}}/api/customers/1/notes/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "content": "URGENT: Customer needs to move by March 2026 due to job relocation. Looking for quick close."
}

### Delete Customer Note
DELETE {{baseUrl}}/api/customers/1/notes/1
Authorization: Bearer {{agentLogin.response.body.token}}

###############################################################################
# SAVED SEARCH ENDPOINTS
###############################################################################

### Get All Saved Searches for Customer
GET {{baseUrl}}/api/customers/1/saved-searches
Authorization: Bearer {{agentLogin.response.body.token}}

### Get Saved Search by ID
GET {{baseUrl}}/api/saved-searches/1
Authorization: Bearer {{agentLogin.response.body.token}}

### Create Saved Search
POST {{baseUrl}}/api/customers/1/saved-searches
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "name": "Dream Family Home",
  "description": "4-bedroom homes with pool and garage in good school districts",
  "filters": [
    {
      "attributeId": 8,
      "dataType": "NUMBER",
      "minValue": 4
    },
    {
      "attributeId": 19,
      "dataType": "BOOLEAN",
      "booleanValue": true
    },
    {
      "attributeId": 18,
      "dataType": "BOOLEAN",
      "booleanValue": true
    }
  ]
}

### Update Saved Search
PUT {{baseUrl}}/api/saved-searches/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "name": "Family Homes 3-5BR - Updated",
  "description": "Single family homes and townhouses with 3-5 bedrooms, 2+ bathrooms, and garage",
  "filters": [
    {
      "attributeId": 8,
      "dataType": "NUMBER",
      "minValue": 3,
      "maxValue": 5
    },
    {
      "attributeId": 9,
      "dataType": "NUMBER",
      "minValue": 2
    },
    {
      "attributeId": 2,
      "dataType": "SINGLE_SELECT",
      "selectedValues": ["Single Family Home", "Townhouse"]
    },
    {
      "attributeId": 18,
      "dataType": "BOOLEAN",
      "booleanValue": true
    }
  ]
}

### Execute Saved Search (find matching properties)
GET {{baseUrl}}/api/saved-searches/1/execute
Authorization: Bearer {{agentLogin.response.body.token}}

### Execute Saved Search with Pagination
GET {{baseUrl}}/api/saved-searches/1/execute?page=0&size=5
Authorization: Bearer {{agentLogin.response.body.token}}

### Delete Saved Search
DELETE {{baseUrl}}/api/saved-searches/1
Authorization: Bearer {{agentLogin.response.body.token}}

###############################################################################
# PROPERTY ATTRIBUTE ENDPOINTS (Admin Only)
###############################################################################

### Get All Property Attributes
GET {{baseUrl}}/api/property-attributes
Authorization: Bearer {{adminLogin.response.body.token}}

### Get Property Attributes by Category
GET {{baseUrl}}/api/property-attributes/by-category?category=FEATURES
Authorization: Bearer {{adminLogin.response.body.token}}

### Get Property Attribute by ID
GET {{baseUrl}}/api/property-attributes/1
Authorization: Bearer {{adminLogin.response.body.token}}

### Search Property Attributes
GET {{baseUrl}}/api/property-attributes/search?name=bedroom
Authorization: Bearer {{adminLogin.response.body.token}}

### Create Property Attribute (Text)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Pet Policy",
  "dataType": "TEXT",
  "category": "BASIC",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 100
}

### Create Property Attribute (Number)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Number of Floors",
  "dataType": "NUMBER",
  "category": "STRUCTURE",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 20
}

### Create Property Attribute (Boolean)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Pet Friendly",
  "dataType": "BOOLEAN",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 50
}

### Create Property Attribute (Single Select with Options)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Parking Type",
  "dataType": "SINGLE_SELECT",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 30,
  "options": [
    {"optionValue": "Garage", "displayOrder": 1},
    {"optionValue": "Carport", "displayOrder": 2},
    {"optionValue": "Street Parking", "displayOrder": 3},
    {"optionValue": "None", "displayOrder": 4}
  ]
}

### Create Property Attribute (Multi Select with Options)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Eco Features",
  "dataType": "MULTI_SELECT",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 40,
  "options": [
    {"optionValue": "Solar Panels", "displayOrder": 1},
    {"optionValue": "Rainwater Harvesting", "displayOrder": 2},
    {"optionValue": "Energy Star Appliances", "displayOrder": 3},
    {"optionValue": "Smart Thermostat", "displayOrder": 4},
    {"optionValue": "LED Lighting", "displayOrder": 5}
  ]
}

### Update Property Attribute
PUT {{baseUrl}}/api/property-attributes/1
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "name": "Street Address",
  "dataType": "TEXT",
  "category": "BASIC",
  "isRequired": true,
  "isSearchable": true,
  "displayOrder": 1
}

### Reorder Property Attributes
POST {{baseUrl}}/api/property-attributes/reorder
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

[
  {"attributeId": 1, "newDisplayOrder": 1},
  {"attributeId": 2, "newDisplayOrder": 2},
  {"attributeId": 3, "newDisplayOrder": 3}
]

### Delete Property Attribute
DELETE {{baseUrl}}/api/property-attributes/100
Authorization: Bearer {{adminLogin.response.body.token}}

###############################################################################
# USER MANAGEMENT ENDPOINTS (Admin Only)
###############################################################################

### Get All Users
GET {{baseUrl}}/api/users
Authorization: Bearer {{adminLogin.response.body.token}}

### Get All Users with Pagination
GET {{baseUrl}}/api/users?page=0&size=10
Authorization: Bearer {{adminLogin.response.body.token}}

### Get User by ID
GET {{baseUrl}}/api/users/1
Authorization: Bearer {{adminLogin.response.body.token}}

### Search Users by Username
GET {{baseUrl}}/api/users/search?username=alice
Authorization: Bearer {{adminLogin.response.body.token}}

### Search Users by Role
GET {{baseUrl}}/api/users/search?role=AGENT
Authorization: Bearer {{adminLogin.response.body.token}}

### Search Users by Status
GET {{baseUrl}}/api/users/search?status=ACTIVE
Authorization: Bearer {{adminLogin.response.body.token}}

### Create New User (Admin creates Agent)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "username": "frank",
  "password": "SecurePassword123!",
  "email": "frank.miller@realestatecrm.com",
  "firstName": "Frank",
  "lastName": "Miller",
  "role": "AGENT",
  "status": "ACTIVE"
}

### Create New User (Admin creates Broker)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "username": "grace",
  "password": "SecurePassword123!",
  "email": "grace.wilson@realestatecrm.com",
  "firstName": "Grace",
  "lastName": "Wilson",
  "role": "BROKER",
  "status": "ACTIVE"
}

### Update User
PUT {{baseUrl}}/api/users/2
Content-Type: {{contentType}}
Authorization: Bearer {{adminLogin.response.body.token}}

{
  "username": "alice",
  "email": "alice.anderson@realestatecrm.com",
  "firstName": "Alice",
  "lastName": "Anderson-Smith",
  "role": "AGENT",
  "status": "ACTIVE"
}

### Update User Status (Deactivate)
PATCH {{baseUrl}}/api/users/2/status?status=INACTIVE
Authorization: Bearer {{adminLogin.response.body.token}}

### Update User Status (Reactivate)
PATCH {{baseUrl}}/api/users/2/status?status=ACTIVE
Authorization: Bearer {{adminLogin.response.body.token}}

### Change User Password (Self)
PATCH {{baseUrl}}/api/users/2/password
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "currentPassword": "password",
  "newPassword": "NewSecurePassword123!"
}

### Delete User
DELETE {{baseUrl}}/api/users/10
Authorization: Bearer {{adminLogin.response.body.token}}

###############################################################################
# USER HIERARCHY ENDPOINTS
###############################################################################

### Get User Subordinates
GET {{baseUrl}}/api/users/3/subordinates
Authorization: Bearer {{brokerLogin.response.body.token}}

### Get User Supervisors
GET {{baseUrl}}/api/users/2/supervisors
Authorization: Bearer {{agentLogin.response.body.token}}

### Add Supervisor (Broker supervises Agent)
POST {{baseUrl}}/api/users/2/supervisors/3
Authorization: Bearer {{adminLogin.response.body.token}}

### Remove Supervisor
DELETE {{baseUrl}}/api/users/2/supervisors/3
Authorization: Bearer {{adminLogin.response.body.token}}

###############################################################################
# HEALTH CHECK & MONITORING
###############################################################################

### Health Check
GET {{baseUrl}}/actuator/health

### Application Info (if enabled)
GET {{baseUrl}}/actuator/info

###############################################################################
# ERROR HANDLING EXAMPLES
###############################################################################

### Test 404 - Property Not Found
GET {{baseUrl}}/api/properties/99999
Authorization: Bearer {{agentLogin.response.body.token}}

### Test 400 - Invalid Request (Missing Required Field)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "description": "Missing title and price"
}

### Test 401 - Unauthorized (No Token)
GET {{baseUrl}}/api/properties

### Test 403 - Forbidden (Assistant tries to create property)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{assistantLogin.response.body.token}}

{
  "title": "Test Property",
  "description": "Should fail - assistants can't create",
  "price": 100000
}

### Test 403 - Forbidden (Agent tries to access admin endpoint)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "name": "Test Attribute",
  "dataType": "TEXT",
  "category": "BASIC"
}

###############################################################################
# BATCH OPERATIONS - Quick Data Setup
###############################################################################

### Quick Setup: Create 3 Properties
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "title": "Riverside Cottage",
  "description": "Charming 2-bed cottage by the river with amazing views",
  "price": 295000,
  "status": "ACTIVE"
}

###
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "title": "Downtown Penthouse",
  "description": "Luxury penthouse with panoramic city views and rooftop terrace",
  "price": 1250000,
  "status": "ACTIVE"
}

###
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentLogin.response.body.token}}

{
  "title": "Suburban Ranch",
  "description": "Classic ranch-style home with large yard and updated kitchen",
  "price": 385000,
  "status": "ACTIVE"
}

###############################################################################
# END OF API TESTS
###############################################################################
