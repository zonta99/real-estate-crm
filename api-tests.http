###############################################################################
# Real Estate CRM - API Testing Suite (with Status Code Assertions)
###############################################################################

@baseUrl = http://localhost:8080
@contentType = application/json

###############################################################################
# AUTHENTICATION ENDPOINTS
###############################################################################

### Login as Admin
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "admin",
  "password": "YourSecurePassword123!"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("adminToken", response.body.token);
    client.global.set("adminRefreshToken", response.body.refreshToken);
%}

### Login as Agent (Alice)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "alice",
  "password": "password"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("agentToken", response.body.token);
    client.global.set("agentRefreshToken", response.body.refreshToken);
%}

### Login as Broker (Bob)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "bob",
  "password": "password"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("brokerToken", response.body.token);
    client.global.set("brokerRefreshToken", response.body.refreshToken);
%}

### Login as Agent (Carol)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "carol",
  "password": "password"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("carolToken", response.body.token);
%}

### Login as Agent (David)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "david",
  "password": "password"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("davidToken", response.body.token);
%}

### Login as Assistant (Emma)
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "emma",
  "password": "password"
}

> {%
    client.test("Login successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
    client.global.set("assistantToken", response.body.token);
%}

### Get Current User Info (requires authentication)
GET {{baseUrl}}/api/auth/user
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get User Permissions
GET {{baseUrl}}/api/auth/permissions
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Refresh Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{agentRefreshToken}}"
}

> {%
    client.test("Token refresh successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{agentToken}}

> {%
    client.test("Logout successful", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

###############################################################################
# PROPERTY ENDPOINTS
###############################################################################

### Get All Properties (Agent)
GET {{baseUrl}}/api/properties
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get All Properties with Pagination
GET {{baseUrl}}/api/properties?page=0&size=5&sort=price,desc
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get Property by ID (with attributes)
GET {{baseUrl}}/api/properties/1
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Properties by Price Range
GET {{baseUrl}}/api/properties/search?minPrice=300000&maxPrice=500000
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Properties by Status
GET {{baseUrl}}/api/properties/search?status=ACTIVE
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Properties with All Filters
GET {{baseUrl}}/api/properties/search?minPrice=200000&maxPrice=1000000&status=ACTIVE&page=0&size=10
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Create New Property (Agent)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "title": "Beautiful Garden Home",
  "description": "Stunning 3-bedroom home with expansive garden and modern finishes. Perfect for nature lovers!",
  "price": 425000,
  "status": "ACTIVE"
}

> {%
    client.test("Property created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
    client.test("Response has id", function() {
        client.assert(response.body.id !== undefined, "Created property has no id");
    });
%}

### Update Property
PUT {{baseUrl}}/api/properties/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "title": "Cozy Family Home - Updated!",
  "description": "3-bed, 2-bath cozy home near parks and schools. Recently updated kitchen!",
  "price": 365000,
  "status": "ACTIVE"
}

> {%
    client.test("Property updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Update Property Status
PATCH {{baseUrl}}/api/properties/1/status?status=SOLD
Authorization: Bearer {{agentToken}}

> {%
    client.test("Status updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Set Property Attribute Values
POST {{baseUrl}}/api/properties/1/attribute-values
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "attributeId": 1,
  "value": "123 Main Street, Springfield, IL"
}

> {%
    client.test("Attribute value set successfully", function() {
        client.assert(response.status === 200 || response.status === 201, "Response status is not 200 or 201");
    });
%}

### Get Property Attribute Values
GET {{baseUrl}}/api/properties/1/attribute-values
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Share Property with Another User
POST {{baseUrl}}/api/properties/3/share
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "sharedWithUserId": 3
}

> {%
    client.test("Property shared successfully", function() {
        client.assert(response.status === 200 || response.status === 201, "Response status is not 200 or 201");
    });
%}

### Get Property Shares
GET {{baseUrl}}/api/properties/1/shares
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Unshare Property
DELETE {{baseUrl}}/api/properties/1/share/3
Authorization: Bearer {{agentToken}}

> {%
    client.test("Property unshared successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

### Delete Property (requires owner or admin)
DELETE {{baseUrl}}/api/properties/1
Authorization: Bearer {{agentToken}}

> {%
    client.test("Property deleted successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

### Search Properties by Saved Search Criteria
POST {{baseUrl}}/api/properties/search/by-criteria
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "minPrice": 300000,
  "maxPrice": 600000,
  "filters": [
    {
      "attributeId": 8,
      "dataType": "NUMBER",
      "minValue": 3,
      "maxValue": 5
    },
    {
      "attributeId": 9,
      "dataType": "NUMBER",
      "minValue": 2
    },
    {
      "attributeId": 2,
      "dataType": "SINGLE_SELECT",
      "selectedValues": ["Single Family Home", "Townhouse"]
    }
  ]
}

> {%
    client.test("Search successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

###############################################################################
# CUSTOMER ENDPOINTS
###############################################################################

### Get All Customers
GET {{baseUrl}}/api/customers
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get All Customers with Pagination
GET {{baseUrl}}/api/customers?page=0&size=5
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get Customer by ID
GET {{baseUrl}}/api/customers/1
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Customers by Name
GET {{baseUrl}}/api/customers/search?name=John
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Customers by Email
GET {{baseUrl}}/api/customers/search?email=john.smith@example.com
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Customers by Status
GET {{baseUrl}}/api/customers/search?status=LEAD
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Customers by Budget Range
GET {{baseUrl}}/api/customers/search?minBudget=200000&maxBudget=500000
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Create New Customer
POST {{baseUrl}}/api/customers
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "firstName": "Jessica",
  "lastName": "Brown",
  "email": "jessica.brown@example.com",
  "phone": "555-0199",
  "budgetMin": 400000,
  "budgetMax": 650000,
  "notes": "Looking for modern home with home office. Works remotely.",
  "leadSource": "Website Inquiry",
  "status": "LEAD"
}

> {%
    client.test("Customer created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
    client.test("Response has id", function() {
        client.assert(response.body.id !== undefined, "Created customer has no id");
    });
%}

### Update Customer
PUT {{baseUrl}}/api/customers/1
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "firstName": "John",
  "lastName": "Smith",
  "email": "john.smith@example.com",
  "phone": "555-0101",
  "budgetMin": 320000,
  "budgetMax": 480000,
  "notes": "Looking for family home with 3+ bedrooms. Needs good school district. Pre-approved for mortgage.",
  "leadSource": "Website Inquiry",
  "status": "QUALIFIED"
}

> {%
    client.test("Customer updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Update Customer Status
PATCH {{baseUrl}}/api/customers/1/status?status=NEGOTIATING
Authorization: Bearer {{agentToken}}

> {%
    client.test("Status updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Delete Customer
DELETE {{baseUrl}}/api/customers/1
Authorization: Bearer {{agentToken}}

> {%
    client.test("Customer deleted successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

###############################################################################
# PROPERTY ATTRIBUTES ENDPOINTS (Admin Only)
###############################################################################

### Get All Property Attributes
GET {{baseUrl}}/api/property-attributes
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get Property Attribute by ID
GET {{baseUrl}}/api/property-attributes/1
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Create Property Attribute (Text)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Lot Size",
  "dataType": "TEXT",
  "category": "BASIC",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 10
}

> {%
    client.test("Attribute created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
    client.test("Response has id", function() {
        client.assert(response.body.id !== undefined, "Created attribute has no id");
    });
%}

### Create Property Attribute (Number)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Number of Floors",
  "dataType": "NUMBER",
  "category": "STRUCTURE",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 20
}

> {%
    client.test("Attribute created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

### Create Property Attribute (Boolean)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Pet Friendly",
  "dataType": "BOOLEAN",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 50
}

> {%
    client.test("Attribute created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

### Create Property Attribute (Single Select with Options)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Parking Type",
  "dataType": "SINGLE_SELECT",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 30,
  "options": [
    {"optionValue": "Garage", "displayOrder": 1},
    {"optionValue": "Carport", "displayOrder": 2},
    {"optionValue": "Street Parking", "displayOrder": 3},
    {"optionValue": "None", "displayOrder": 4}
  ]
}

> {%
    client.test("Attribute created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

### Create Property Attribute (Multi Select with Options)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Eco Features",
  "dataType": "MULTI_SELECT",
  "category": "FEATURES",
  "isRequired": false,
  "isSearchable": true,
  "displayOrder": 40,
  "options": [
    {"optionValue": "Solar Panels", "displayOrder": 1},
    {"optionValue": "Rainwater Harvesting", "displayOrder": 2},
    {"optionValue": "Energy Star Appliances", "displayOrder": 3},
    {"optionValue": "Smart Thermostat", "displayOrder": 4},
    {"optionValue": "LED Lighting", "displayOrder": 5}
  ]
}

> {%
    client.test("Attribute created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

### Update Property Attribute
PUT {{baseUrl}}/api/property-attributes/1
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "name": "Street Address",
  "dataType": "TEXT",
  "category": "BASIC",
  "isRequired": true,
  "isSearchable": true,
  "displayOrder": 1
}

> {%
    client.test("Attribute updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Reorder Property Attributes
POST {{baseUrl}}/api/property-attributes/reorder
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

[
  {"attributeId": 1, "newDisplayOrder": 1},
  {"attributeId": 2, "newDisplayOrder": 2},
  {"attributeId": 3, "newDisplayOrder": 3}
]

> {%
    client.test("Reorder successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Delete Property Attribute
DELETE {{baseUrl}}/api/property-attributes/100
Authorization: Bearer {{adminToken}}

> {%
    client.test("Attribute deleted successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

###############################################################################
# USER MANAGEMENT ENDPOINTS (Admin Only)
###############################################################################

### Get All Users
GET {{baseUrl}}/api/users
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get All Users with Pagination
GET {{baseUrl}}/api/users?page=0&size=10
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get User by ID
GET {{baseUrl}}/api/users/1
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Users by Username
GET {{baseUrl}}/api/users/search?username=alice
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Users by Role
GET {{baseUrl}}/api/users/search?role=AGENT
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Search Users by Status
GET {{baseUrl}}/api/users/search?status=ACTIVE
Authorization: Bearer {{adminToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Create New User (Admin creates Agent)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "username": "frank",
  "password": "SecurePassword123!",
  "email": "frank.miller@realestatecrm.com",
  "firstName": "Frank",
  "lastName": "Miller",
  "role": "AGENT",
  "status": "ACTIVE"
}

> {%
    client.test("User created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
    client.test("Response has id", function() {
        client.assert(response.body.id !== undefined, "Created user has no id");
    });
%}

### Create New User (Admin creates Broker)
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "username": "grace",
  "password": "SecurePassword123!",
  "email": "grace.wilson@realestatecrm.com",
  "firstName": "Grace",
  "lastName": "Wilson",
  "role": "BROKER",
  "status": "ACTIVE"
}

> {%
    client.test("User created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

### Update User
PUT {{baseUrl}}/api/users/2
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "username": "alice",
  "email": "alice.anderson@realestatecrm.com",
  "firstName": "Alice",
  "lastName": "Anderson-Smith",
  "role": "AGENT",
  "status": "ACTIVE"
}

> {%
    client.test("User updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Update User Status (Deactivate)
PATCH {{baseUrl}}/api/users/2/status?status=INACTIVE
Authorization: Bearer {{adminToken}}

> {%
    client.test("Status updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Update User Status (Reactivate)
PATCH {{baseUrl}}/api/users/2/status?status=ACTIVE
Authorization: Bearer {{adminToken}}

> {%
    client.test("Status updated successfully", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Change User Password (Self)
PATCH {{baseUrl}}/api/users/2/password
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "currentPassword": "password",
  "newPassword": "NewSecurePassword123!"
}

> {%
    client.test("Password changed successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

### Delete User
DELETE {{baseUrl}}/api/users/10
Authorization: Bearer {{adminToken}}

> {%
    client.test("User deleted successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

###############################################################################
# USER HIERARCHY ENDPOINTS
###############################################################################

### Get User Subordinates
GET {{baseUrl}}/api/users/3/subordinates
Authorization: Bearer {{brokerToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Get User Supervisors
GET {{baseUrl}}/api/users/2/supervisors
Authorization: Bearer {{agentToken}}

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Add Supervisor (Broker supervises Agent)
POST {{baseUrl}}/api/users/2/supervisors/3
Authorization: Bearer {{adminToken}}

> {%
    client.test("Supervisor added successfully", function() {
        client.assert(response.status === 200 || response.status === 201, "Response status is not 200 or 201");
    });
%}

### Remove Supervisor
DELETE {{baseUrl}}/api/users/2/supervisors/3
Authorization: Bearer {{adminToken}}

> {%
    client.test("Supervisor removed successfully", function() {
        client.assert(response.status === 200 || response.status === 204, "Response status is not 200 or 204");
    });
%}

###############################################################################
# HEALTH CHECK & MONITORING
###############################################################################

### Health Check
GET {{baseUrl}}/actuator/health

> {%
    client.test("Health check successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

### Application Info (if enabled)
GET {{baseUrl}}/actuator/info

> {%
    client.test("Request successful", function() {
        client.assert(response.status === 200, "Response status is not 200");
    });
%}

###############################################################################
# ERROR HANDLING EXAMPLES
###############################################################################

### Test 404 - Property Not Found
GET {{baseUrl}}/api/properties/99999
Authorization: Bearer {{agentToken}}

> {%
    client.test("Returns 404 for non-existent property", function() {
        client.assert(response.status === 404, "Response status is not 404");
    });
%}

### Test 400 - Invalid Request (Missing Required Field)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "description": "Missing title and price"
}

> {%
    client.test("Returns 400 for invalid request", function() {
        client.assert(response.status === 400, "Response status is not 400");
    });
%}

### Test 401 - Unauthorized (No Token)
GET {{baseUrl}}/api/properties

> {%
    client.test("Returns 401 for unauthorized request", function() {
        client.assert(response.status === 401, "Response status is not 401");
    });
%}

### Test 403 - Forbidden (Assistant tries to create property)
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{assistantToken}}

{
  "title": "Test Property",
  "description": "Should fail - assistants can't create",
  "price": 100000
}

> {%
    client.test("Returns 403 for forbidden action", function() {
        client.assert(response.status === 403, "Response status is not 403");
    });
%}

### Test 403 - Forbidden (Agent tries to access admin endpoint)
POST {{baseUrl}}/api/property-attributes
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "name": "Test Attribute",
  "dataType": "TEXT",
  "category": "BASIC"
}

> {%
    client.test("Returns 403 for forbidden action", function() {
        client.assert(response.status === 403, "Response status is not 403");
    });
%}

###############################################################################
# BATCH OPERATIONS - Quick Data Setup
###############################################################################

### Quick Setup: Create 3 Properties
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "title": "Riverside Cottage",
  "description": "Charming 2-bed cottage by the river with amazing views",
  "price": 295000,
  "status": "ACTIVE"
}

> {%
    client.test("Property created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

###
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "title": "Downtown Penthouse",
  "description": "Luxury penthouse with panoramic city views and rooftop terrace",
  "price": 1250000,
  "status": "ACTIVE"
}

> {%
    client.test("Property created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

###
POST {{baseUrl}}/api/properties
Content-Type: {{contentType}}
Authorization: Bearer {{agentToken}}

{
  "title": "Suburban Ranch",
  "description": "Classic ranch-style home with large yard and updated kitchen",
  "price": 385000,
  "status": "ACTIVE"
}

> {%
    client.test("Property created successfully", function() {
        client.assert(response.status === 201, "Response status is not 201");
    });
%}

###############################################################################
# END OF API TESTS
###############################################################################
